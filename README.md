# 3D_Othello

## ゲーム概要
- 3 次元のリング状セルで構成されるオセロ（リバーシ）を Swift / SceneKit で実装したプロジェクトです。
- ボードサイズは偶数を想定した立方体（例: 4x4x4, 6x6x6 など）で、各セルは 0 ベースの x, y, z 座標で管理します。
- 手番プレイヤーはリングを 1 つだけ選択し、そのリングに石を置くことで 26 方向に挟める相手石をひっくり返します。

## 盤面インデックス計算
- 盤面は 1 次元配列で保持し、`index = x + y * size + z * size * size` でアクセスします。
- `size` はボード一辺のセル数、`x`, `y`, `z` は 0 以上 `size-1` 以下の整数です。
- 配列境界チェックは `0 <= x, y, z < size` を満たす場合のみ有効なインデックスとして扱います。

## 26 方向ベクトル
- 3D では 6 方向（軸方向）、12 方向（面対角）、8 方向（体対角）の合計 26 方向を走査します。
- ベクトルの組み合わせ（dx, dy, dz）は次の通りです（0,0,0 を除外）。
  - 軸方向: (±1,0,0), (0,±1,0), (0,0,±1)
  - 面対角: (±1,±1,0), (±1,0,±1), (0,±1,±1)
  - 体対角: (±1,±1,±1)
- 実装ではこれら 26 個の組を配列で保持し、合法手判定や反転処理に利用します。

## 初期配置 A
- 立方体の中心を 2x2x2 のブロックとして初期石を配置します（偶数サイズの場合は中央 2 層を使用）。
- 例（size = 4 の場合、`(x, y, z)` で表記）：
  - 先手: (1,1,1), (2,2,2), (1,2,2), (2,1,1)
  - 後手: (1,1,2), (2,2,1), (1,2,1), (2,1,2)
- 奇数サイズの場合も中央付近で同様の交互配置に揃え、上下左右前後方向の対称性を保ちます。

## 合法手判定アルゴリズム
1. 空セルを候補として走査し、全 26 方向を確認します。
2. ある方向 (dx, dy, dz) に隣接するセルが相手石の場合のみ、同方向に連続して進みます。
3. 空セルに到達した場合は失敗、同じプレイヤーの石に到達した場合はその間にある相手石をすべて反転対象として合法手と判定します。
4. 1 つでも反転対象が見つかればそのセルは合法手、反転対象が 0 の場合は非合法手とします。
5. 全セルに合法手が無いときはパス、両者連続パスでゲーム終了です。

## UI / 操作
- **リングのみ選択:** 各セルはリング型ノードで表現され、ハイライトされたリングのみタップして選択・着手します。複数選択は不可です。
- **カメラ操作:** ピンチでズーム、ドラッグで回転、2 本指ドラッグで平行移動。カメラは常にボード中心を注視します。
- **スコア表示:** 画面右上に黒/白の石数と手番を表示し、反転後にリアルタイム更新します。
- **パス / 終了条件:** 合法手が無い場合はパスボタンが有効になり、両プレイヤーが連続パスした時点で終了ダイアログを表示します。
- **リスタート手順:** 終了ダイアログ、または設定メニュー内の「Restart」からボードを初期化し、初期配置 A を再セットします。

## ビルド・テスト手順
- SwiftPM:
  - 依存: Swift 5.9 以降、SceneKit 利用のため macOS / iOS 対応環境。
  - `swift build` でビルド、`swift test` でユニットテストを実行します。
- Xcode:
  - 推奨: Xcode 15 以降。`3D_Othello.xcodeproj` または `Package.swift` を開き、iOS 17 以降のターゲットを指定してください。
  - 実機/シミュレーターは A12 以降の 64bit デバイスを推奨。`Cmd + R` で実行、`Cmd + U` でテスト。
- CI / その他:
  - ビルド設定で Metal/SceneKit を有効化し、リリースビルドでは `-O` 最適化を使用します。
  - 物理デバイスでの動作確認時は ARKit を無効化した通常の SceneKit ルートに切り替えて検証してください。
